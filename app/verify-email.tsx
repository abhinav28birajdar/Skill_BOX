import React, { useState, useEffect, useRef } from 'react';
import {\n  View,\n  Text,\n  TextInput,\n  TouchableOpacity,\n  StatusBar,\n  Alert\n} from 'react-native';\nimport { SafeAreaView } from 'react-native-safe-area-context';\nimport { useRouter } from 'expo-router';\nimport { Ionicons } from '@expo/vector-icons';\nimport { Button } from '../src/components/ui/Button';\nimport { useThemeColors } from '../src/theme';\nimport { useAuth } from '../src/hooks/useAuth';\n\nexport default function VerifyEmailScreen() {\n  const router = useRouter();\n  const colors = useThemeColors();\n  const { user, resendVerification } = useAuth();\n  const [code, setCode] = useState(['', '', '', '', '', '']);\n  const [loading, setLoading] = useState(false);\n  const [timer, setTimer] = useState(60);\n  const [canResend, setCanResend] = useState(false);\n  const inputRefs = useRef<TextInput[]>([]);\n\n  useEffect(() => {\n    const countdown = setInterval(() => {\n      setTimer((prev) => {\n        if (prev <= 1) {\n          setCanResend(true);\n          clearInterval(countdown);\n          return 0;\n        }\n        return prev - 1;\n      });\n    }, 1000);\n\n    return () => clearInterval(countdown);\n  }, []);\n\n  const handleCodeChange = (text: string, index: number) => {\n    const newCode = [...code];\n    newCode[index] = text;\n    setCode(newCode);\n\n    // Auto-focus next input\n    if (text && index < 5) {\n      inputRefs.current[index + 1]?.focus();\n    }\n  };\n\n  const handleKeyPress = (key: string, index: number) => {\n    if (key === 'Backspace' && !code[index] && index > 0) {\n      inputRefs.current[index - 1]?.focus();\n    }\n  };\n\n  const handleVerify = async () => {\n    const verificationCode = code.join('');\n    if (verificationCode.length !== 6) {\n      Alert.alert('Error', 'Please enter the complete verification code');\n      return;\n    }\n\n    setLoading(true);\n    // Simulate verification process\n    setTimeout(() => {\n      setLoading(false);\n      Alert.alert('Success', 'Email verified successfully!', [\n        { text: 'OK', onPress: () => router.replace('/(student)') }\n      ]);\n    }, 2000);\n  };\n\n  const handleResend = async () => {\n    if (!canResend) return;\n    \n    setLoading(true);\n    await resendVerification?.();\n    setLoading(false);\n    setTimer(60);\n    setCanResend(false);\n  };\n\n  return (\n    <SafeAreaView style={{ flex: 1, backgroundColor: colors.background }}>\n      <StatusBar barStyle=\"dark-content\" />\n      \n      {/* Header */}\n      <View className=\"px-6 pt-4 pb-8\">\n        <TouchableOpacity \n          onPress={() => router.back()}\n          className=\"w-10 h-10 rounded-full items-center justify-center mb-6\"\n          style={{ backgroundColor: colors.surface }}\n        >\n          <Ionicons name=\"chevron-back\" size={24} color={colors.text} />\n        </TouchableOpacity>\n      </View>\n\n      <View className=\"flex-1 px-6\">\n        {/* Icon */}\n        <View className=\"items-center mb-8\">\n          <View \n            className=\"w-24 h-24 rounded-full items-center justify-center mb-6\"\n            style={{ backgroundColor: colors.primary + '20' }}\n          >\n            <Ionicons name=\"mail-outline\" size={40} color={colors.primary} />\n          </View>\n          \n          <Text \n            className=\"text-3xl font-bold text-center mb-4\"\n            style={{ color: colors.text }}\n          >\n            Check your email\n          </Text>\n          \n          <Text \n            className=\"text-lg text-center leading-6\"\n            style={{ color: colors.textSecondary }}\n          >\n            We've sent a 6-digit verification code to{' '}\n            <Text style={{ color: colors.text, fontWeight: '600' }}>\n              {user?.email}\n            </Text>\n          </Text>\n        </View>\n\n        {/* Code Input */}\n        <View className=\"mb-8\">\n          <Text \n            className=\"text-base font-semibold mb-4 text-center\"\n            style={{ color: colors.text }}\n          >\n            Enter verification code\n          </Text>\n          \n          <View className=\"flex-row justify-center space-x-3\">\n            {code.map((digit, index) => (\n              <TextInput\n                key={index}\n                ref={(ref) => (inputRefs.current[index] = ref!)}\n                value={digit}\n                onChangeText={(text) => handleCodeChange(text, index)}\n                onKeyPress={({ nativeEvent }) => handleKeyPress(nativeEvent.key, index)}\n                maxLength={1}\n                keyboardType=\"numeric\"\n                className=\"w-12 h-12 rounded-xl text-center text-xl font-bold border-2\"\n                style={{ \n                  borderColor: digit ? colors.primary : colors.border,\n                  backgroundColor: colors.surface,\n                  color: colors.text\n                }}\n              />\n            ))}\n          </View>\n        </View>\n\n        {/* Verify Button */}\n        <Button\n          title=\"Verify Email\"\n          onPress={handleVerify}\n          loading={loading}\n          fullWidth\n          size=\"lg\"\n          style={{ marginBottom: 24 }}\n        />\n\n        {/* Resend */}\n        <View className=\"items-center\">\n          <Text \n            className=\"text-sm mb-2\"\n            style={{ color: colors.textSecondary }}\n          >\n            Didn't receive the code?\n          </Text>\n          \n          {canResend ? (\n            <TouchableOpacity onPress={handleResend}>\n              <Text \n                className=\"text-base font-semibold\"\n                style={{ color: colors.primary }}\n              >\n                Resend Code\n              </Text>\n            </TouchableOpacity>\n          ) : (\n            <Text \n              className=\"text-sm\"\n              style={{ color: colors.textTertiary }}\n            >\n              Resend in {timer}s\n            </Text>\n          )}\n        </View>\n      </View>\n    </SafeAreaView>\n  );\n}